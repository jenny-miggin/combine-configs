# Config splitting

This repository demonstrates the basic usage of the orb `circle-makotom-orbs/config-splitting`.

## Quick hands-on

1.  Fork this repository.
2.  Go to https://app.circleci.com/settings/project/github/YOUR_GITHUB_ORG_NAME/circle-combine-split-config/advanced and enable the option `Enable dynamic config using setup workflows`
3.  Go to https://app.circleci.com/settings/project/github/YOUR_GITHUB_ORG_NAME/circle-combine-split-config and hit the `Follow Project` button there.
    This action will trigger the first pipeline for your forked project.

## Behind the scenes

### Selectively merging config files

This demonstrates how to create a single config file out of multiple config files, depending on which directory has code changes within it

- `.circleci/config.yml` defines the `setup` workflow. The `setup` workflow calls `run-modular-configs-selectively` job of the config-splitting orb
- There are 2 "modular" configs: `subdir-a/.circleci/config.yml` and `subdir-b/.circleci/config.yml`
- There are also a series of config files located in the root of `.circleci`
- For the `dynamic-merge` branch, analysis will be done to find directories/ `subdir`s with code changes within them
- The directories to be analysed are defined in the `subdir-list.txt` file. If the directory is not listed there, then no analysis will be done on this directory.
- Each `subdir` has a file called `.circleci-config-dependencies` that defines which configs to merge if there is a change found in that directory
- The combined config generated by the `setup` workflow is passed back to CircleCI and then is executed accordingly.
